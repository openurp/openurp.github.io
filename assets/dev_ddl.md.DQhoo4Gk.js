import{_ as a,c as e,o as l,ae as n}from"./chunks/framework.DNjB2eFM.js";const b=JSON.parse('{"title":"数据库DDL生成和变更","description":"","frontmatter":{},"headers":[],"relativePath":"dev/ddl.md","filePath":"dev/ddl.md"}'),t={name:"dev/ddl.md"};function i(p,s,d,c,o,r){return l(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="数据库ddl生成和变更" tabindex="-1">数据库DDL生成和变更 <a class="header-anchor" href="#数据库ddl生成和变更" aria-label="Permalink to &quot;数据库DDL生成和变更&quot;">​</a></h1><h3 id="_1-自动生成ddl" tabindex="-1">1.自动生成ddl <a class="header-anchor" href="#_1-自动生成ddl" aria-label="Permalink to &quot;1.自动生成ddl&quot;">​</a></h3><p>OpenURP中的数据模型可以支持多种数据库环境。鉴于大量的表是可以自动生成（其他的函数和存储过程以及优化的索引是需要单独维护的），因此可以使用工具支持。 beangle的tools插件能够自动生成的包括表定义、序列定义、注释。例如生成Oracle10g以上的sql语句，可以在项目根目录下运行：</p><div class="language-scala vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">scala</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sbt ormDdl</span></span></code></pre></div><p>生成的sql会放置在\${project.dir}/target/db/目录下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>0-schemas.sql schema定义</span></span>
<span class="line"><span>1-tables.sql 表定义</span></span>
<span class="line"><span>2-keys.sql 主键定义</span></span>
<span class="line"><span>3-indices.sql 索引定义</span></span>
<span class="line"><span>4-constraints.sql 约束定义</span></span>
<span class="line"><span>6-comments.sql 注释</span></span>
<span class="line"><span>7-auxiliaries.sql 其他</span></span>
<span class="line"><span>database.xml 整个数据定义的xml</span></span></code></pre></div><p>默认是多种数据库同时生成(db2,h2,mysql,oracle,postgresql,sqlserver)</p><p>对于有些数据库不支持Comment On语法后期添加注释，这时注释一般在1-tables.sql(例如mysql)，从而省略了3-comments.sql。</p><h3 id="_2-生成数据迁移ddl" tabindex="-1">2.生成数据迁移ddl <a class="header-anchor" href="#_2-生成数据迁移ddl" aria-label="Permalink to &quot;2.生成数据迁移ddl&quot;">​</a></h3><p>将不同版本的数据库结构定义xml准备好，例如db-0.0.1.xml和db-0.0.2.xml,放到/src/main/resources/db/postgres/目录下 执行如下命令：</p><div class="language-scala vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">scala</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sbt ddlDiff </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.2</span></span></code></pre></div><p>会在target/db/postgresql/migrate/下生成0.0.1-0.0.2.sql</p><h3 id="_3-生成数据库结构报告" tabindex="-1">3. 生成数据库结构报告 <a class="header-anchor" href="#_3-生成数据库结构报告" aria-label="Permalink to &quot;3. 生成数据库结构报告&quot;">​</a></h3><p>在项目中<code>src/main/resources/db/postgresql/</code>准备好结构文件：<code>database.xml</code>和<code>report.xml</code>，命令行中执行</p><div class="language-scala vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">scala</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sbt ddlReport</span></span></code></pre></div><p>可以生成数据结构报告。</p>`,16)])])}const m=a(t,[["render",i]]);export{b as __pageData,m as default};
