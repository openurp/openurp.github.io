# 数据库对象结构设计策略

## 一、数据库总体要求

### 1.1 总体要求

  1. 数据库采用了PostgreSQL 9以上,Maria/MySQL 5以上，Oracle 10g以上的版本
  2. 对于维护十年以上的数据，默认表空间最少要4G

### 1.2 对象命名约定和规则

  1. 数据库中表、视图、索引采用英文及其缩写，尽量避免使用汉语拼音首字母缩写，方便查找，避免猜测。
  2. 按照模块的前缀组织表和视图的命名
  3. 使用复数命名表明和视图名，例如Students表示student，People表示person，没有特殊的划分不许要增加_T或者T_之类的前后缀。
  4. 数据库列命名上,采用xxx_at表示时间和日期,xx_on表示日期，例如start_on表示开始日期
  5. 数据库序列采用seq_作为前缀，默认后续为表名，表示对应的表使用的序列
  6. 索引采用idx_作为前缀
  7. 所有数据库对象的命名使用为小写字母。
  8. 所有数据库对象命名长度一般不能超过30字符。

## 二、数据ID类型设计和分区

### 2.1 ID 类型

OpenURP系统支持数字和字符串两种ID类型。数字ID的生成策略如下：

* auto_increment 支持自增长,适用于缓慢增长的数据，基于next_id('{table_name}')方法生成。
* code 支持将代码直接转换成数字作为ID，这种策略适用于基础代码、字典类数据。
* 有时间特征数据采用date_id+seq,或者date_time_id+seq

### 2.2 数据分区策略

一旦数据量过大，考虑数据分区的策略。Openurp在部署阶段支持按照学年进行拆分的方法，而不是按照按照ID进行划分的方式，
例如成绩、选课记录等，这些表需要有学年字段(int)，方可进行拆分。数据分区时，可以在schema内部建立新表，然后建立合适的路由即可。
如果分区牵涉的数据表较多，可以建立具有时间阶梯的schema组进行处理。这里以教务为例。

如果以学年划分数据比较合适，教务的很多表都需要进行分表切分，因此我们建立如下策略

* his_2015  表示2011～2012到2015-2020五个学年的数据
* his_2020  表示2016～2016到2020-2021五个学年的数据

尝试以每五年做一次数据切分和归档处理。

数据库分表策略尽量按照数据库支持的技术进行构建。例如在Postgresql中支持表继承和分区技术。

## 三、模块命名设计
整个urp系统采用模块式的布局进行构建。由于涉及到教务、学籍、教学质量等众多的业务方面，因此如何这些模块，防止命名冲突，以及增强可维护性等都带来了挑战。虽然整个urp系统可以碎片化部署，但是整体上代码会更多的考虑兼容性。因此不会选择随机的字符串作为每个模块的名称，而是给每个模块在固定的命名空间下，一个固定的不冲突的名称。这样的思路在restful service url设计和数据库schema规划上会更好的遵循。
每个模块下需要设置一个基础模块base,该模块是将整个业务的基础部分进行归纳和精简，其他业务依赖该业务时，大多依赖的公约数部分。

采用大尺度划分为7业务范围，以下列举这些业务的命名空间规范：

* code           表示国标和行业标准
* base           表示基础模块(人员、场所、校历、公共代码标准)
* edu(education) 表示教学教务、学生培养、学生教育相关的业务
* std(student)   表示学生服务相关业务
* degree         表示学位、论文相关
* qos(qos)       表示教学质量
* prac(practice) 表示实践教学

### 3.1 教学(Edu)

* clazz       表示排课、选课
* exam        表示考务
* program     表示培养方案
* exam        表示考务
* attance     表示考勤
* project     表示教学项目管理
* ...         其他(离校、毕业、迎新、就业等相关事务)

### 3.2 学生信息(Std)

* alter       表示学籍异动
* award       表示综合评定、奖学金、助学金业务
* exhcnage    表示校外学习
* fee         表示收费信息
* graduation  表示毕业信息
* info        表示学生信息
* register    表示注册报到
* transfer    表示转专业

### 3.3 教学质量(QoS)

* evaluation  表示课程评价

### 3.4 实践教学(Prac)

* innovation   表示大学生创新创业

### 四、其他维护说明

* 不要在数据库中建立过多的临时表，临时表应建立在tmp schema下。
* 定期备份数据库，做好恢复准备。
* 定期监视sql语句历史，为优化做准备。
* 对经常进行读写，并且数据量较大的表格进行重组。
* 本设计未在MS SQL Server，DB2等系统上进行测试过。
