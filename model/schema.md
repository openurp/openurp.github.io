---
layout: page
title: 数据库设计
description: "数据库设计"
categories: [database-schema-1.0.0]
version: ["1.0.0"]
---
{% include JB/setup %}

## 一、URP模块的命名原则

### 1.1 模块命名规则

整个urp系统采用模块式的布局进行构建。由于涉及到教学、科研、人事等众多的业务方面，因此如何这些模块，防止命名冲突，以及增强可维护性等都带来了挑战。虽然整个urp系统可以碎片化部署，但是整体上代码会更多的考虑兼容性。因此不会选择随机的字符串作为每个模块的名称，而是给每个模块在固定的命名空间下，一个固定的不冲突的名称。这样的思路在restful service url设计和数据库schema规划上会更好的遵循。

### 1.2 数据库对象命名

* 所有urp的数据库表采用英文复数命名。以学生学籍表为例为students，没有特殊的划分不许要增加_T或者T_之类的前后缀。
* 所有数据库对象的命名使用为小写字母。
* 所有数据库对象命名长度一般不能超过30字符。

## 二、具体的模块命名
每个模块下需要设置一个基础模块base,该模块是将整个业务的基础部分进行归纳和精简，其他业务依赖该业务时，大多依赖的公约数部分。

采用大尺度划分为5业务范围，以下列举这些业务的命名空间规范：

* base           表示基础模块(人员、场所、校历、公共代码标准)
* edu(education) 表示教学教务、学生培养、学生教育相关的业务模块
* sin(science)   表示科研相关业务
* hr(human resource) 表示人事相关数据
* fn(financial)  表示财务相关
* lg(logistics)  表示后勤业务

### 2.1 教学(Edu)下的模块命名

* base        表示基础部分(专业、学生、教师、教学代码标准）
* teach       表示教务(课程、计划、排课、选课、成绩、考试、毕业资格审核）
* student     表示学籍管理、学生信息、注册、报到
* quality     表示教学质量监控
* attance     表示考勤
* scholarship 表示综合评定、奖学金、助学金业务
* project     表示教学项目管理
* ...         其他(离校、毕业、迎新、就业等相关事务)

### 2.2 人事(Hr)下的模块命名

* base        表示基础部分(基础教职工数据、人事代码标准)
* staff       表示人事教工信息

### 2.3 科研(Sin)下的模块命名

* base        表示基础部分(科研代码标准)
* harvest     表示科研成果管理业务
* project？   拟为科研项目业务 

### 2.4 财务(Fn)下的模块命名

* base        表示基础部分

### 2.5 后勤(Lg)下的模块命名

* base        表示基础部分
* asset       表示资产部分

## 三、模块依赖

一般遵循以下原则

* 针对每个大业务的基础模块，不能依赖其他业务的非基础模块
* 大业务中的模块可以引用其他业务的模块

## 四、数据库shema设计

每个模块一个单独的schema，数据库中的schema按照二级命名规则进行设计，将大业务的缩写和模块的名称通过下划线串联起来表示。

以下给出几个例子：

* lg_asset    表示资产
* edu_teach   表示教务
* edu_student 表示学生信息

## 五、数据分区策略

一旦数据量过大，考虑数据分区的策略。数据分区时可以在schema内部建立新表，然后建立合适的路由即可。
如果分区牵涉的数据表较多，可以建立具有时间阶梯的schema组进行处理。这里以教务为例。

如果以学年划分数据比较合适的化，教务的很多表都需要进行分表切分，因此我们建立如下策略

* edu_teach2005_2010  表示2005～2006到2010～2011学年的数据
* edu_teach2011_2015  表示2011～2012到2015～2016学年的数据

尝试以每五年做一次数据切分和归档处理。

数据库分表策略尽量按照数据库支持的技术进行构建。例如在Postgresql中支持表继承和检查约束(Check Constraint),可以使用函数触发器
实现增删改查的分表功能。以教务中的成绩为例：

course_grades 表示成绩表，teach2014.course_grades表示2014学年生成的成绩表，可以如此创建这张表：

    CREATE TABLE teach2014.course_grades
    (
      CONSTRAINT yearid CHECK (id >= 201400000000000001::bigint AND id <= 201500000000000000::bigint)
    )
    INHERITS (teach.course_grades)

然后在course_grades增加触发器：


### 六、ID生成策略

Openurp系统支持数字和字符串两种ID类型。数字ID的生成策略如下：

* code 支持将代码直接转换成数字作为ID，这种策略适用于基础代码、字典类数据
* auto_increment 支持自增长
* date 支持根据实体中的年份数据，生成ID。例如2014年的教学任务，保存时，jpa层会执行next_id(teach.lessons,2014) 会得到2014年teach.lessons表中Id的下一个值。

